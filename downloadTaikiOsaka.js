import { fetchBinPOST } from "https://js.sabae.cc/fetchPOST.js";
import { SJIS } from "https://js.sabae.cc/SJIS.js";
import { CSV } from "https://js.sabae.cc/CSV.js";
import { DateTime, Day, Time } from "https://js.sabae.cc/DateTime.js";
import { fix0 } from "https://js.sabae.cc/fix0.js";

/*
const s = `formNo=040&nextForm=%2Fbin%2Fform1000%2FForm_1021.jsp&dataInfo=%7B%22areaName%22%3Anull%2C%22areaNumber%22%3Anull%2C%22browseEnd%22%3A0%2C%22browsePriod%22%3A%22168%22%2C%22browseStart%22%3A0%2C%22buttonType%22%3Anull%2C%22changeType%22%3Anull%2C%22cmbType%22%3Anull%2C%22dailyRreport%22%3Anull%2C%22dayAdd%22%3A%22168%22%2C%22endDate%22%3A%222021%2F10%2F09%22%2C%22endHour%22%3A%2206%22%2C%22endMin%22%3Anull%2C%22formNo%22%3A0%2C%22graphName%22%3Anull%2C%22id%22%3A%220%22%2C%22itemInfo%22%3A%5B%5B%22009%22%5D%2C%5B%22OX%22%5D%2C%5B%22ppb%22%5D%5D%2C%22itemName%22%3Anull%2C%22kenteiType%22%3Anull%2C%22markStationItem%22%3A%220104_009%2C0107_009%2C0109_009%2C0112_009%2C0115_009%2C0116_009%2C0117_009%2C0118_009%2C0120_009%2C0121_009%2C0122_009%2C0123_009%2C0124_009%2C0125_009%2C0127_009%2C0129_009%2C0130_009%2C0131_009%2C0133_009%2C0202_009%2C0203_009%2C0205_009%2C0206_009%2C0207_009%2C0208_009%2C0209_009%2C0210_009%2C0211_009%2C0212_009%2C0213_009%2C0215_009%2C0252_009%2C0301_009%2C0302_009%2C0304_009%2C0305_009%2C0307_009%2C0309_009%2C0311_009%2C0312_009%2C0313_009%2C0405_009%2C0602_009%2C0651_009%2C0652_009%2C0701_009%2C0703_009%2C0705_009%2C0801_009%2C0802_009%2C0851_009%2C0901_009%2C0902_009%2C0903_009%2C2102_009%2C2103_009%2C2202_009%2C2301_009%2C2302_009%2C%22%2C%22maxId%22%3A%221%22%2C%22maxItemString%22%3A%22%22%2C%22startDate%22%3A%222021%2F10%2F02%22%2C%22startHour%22%3A%2206%22%2C%22startMin%22%3Anull%2C%22stationCodeOfArea%22%3Anull%2C%22stationInfo%22%3A%5B%5B%220104%22%2C%220107%22%2C%220109%22%2C%220112%22%2C%220115%22%2C%220116%22%2C%220117%22%2C%220118%22%2C%220120%22%2C%220121%22%2C%220122%22%2C%220123%22%2C%220124%22%2C%220125%22%2C%220127%22%2C%220129%22%2C%220130%22%2C%220131%22%2C%220133%22%2C%220202%22%2C%220203%22%2C%220205%22%2C%220206%22%2C%220207%22%2C%220208%22%2C%220209%22%2C%220210%22%2C%220211%22%2C%220212%22%2C%220213%22%2C%220215%22%2C%220252%22%2C%220301%22%2C%220302%22%2C%220304%22%2C%220305%22%2C%220307%22%2C%220309%22%2C%220311%22%2C%220312%22%2C%220313%22%2C%220405%22%2C%220602%22%2C%220651%22%2C%220652%22%2C%220701%22%2C%220703%22%2C%220705%22%2C%220801%22%2C%220802%22%2C%220851%22%2C%220901%22%2C%220902%22%2C%220903%22%2C%222102%22%2C%222103%22%2C%222202%22%2C%222301%22%2C%222302%22%5D%2C%5B%22%E8%A5%BF%E9%83%A8%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E5%9B%BD%E8%A8%AD%E5%A4%A7%E9%98%AA%22%2C%22%E8%8C%A8%E6%9C%A8%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E9%AB%98%E7%9F%B3%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B1%A0%E7%94%B0%E5%B8%82%E7%AB%8B%E5%8D%97%E7%95%91%E4%BC%9A%E9%A4%A8%22%2C%22%E5%A4%A7%E6%9D%B1%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%BA%9C%E7%AB%8B%E4%BF%AE%E5%BE%B3%E5%AD%A6%E9%99%A2%22%2C%22%E8%B2%9D%E5%A1%9A%E5%B8%82%E6%B6%88%E9%98%B2%E7%BD%B2%22%2C%22%E5%B3%B6%E6%9C%AC%E7%94%BA%E5%BD%B9%E5%A0%B4%22%2C%22%E5%AF%8C%E7%94%B0%E6%9E%97%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%8D%97%E6%B5%B7%E5%9B%A3%E5%9C%B0%22%2C%22%E6%B3%89%E5%8D%97%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E7%B7%91%E3%82%B1%E4%B8%98%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E4%B8%89%E6%97%A5%E5%B8%82%E5%85%AC%E6%B0%91%E9%A4%A8%22%2C%22%E8%97%A4%E4%BA%95%E5%AF%BA%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%B2%B8%E5%92%8C%E7%94%B0%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9C%92%22%2C%22%E4%BD%90%E9%87%8E%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B3%89%E5%A4%A7%E6%B4%A5%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E8%B1%8A%E8%83%BD%E7%94%BA%E5%BD%B9%E5%A0%B4%22%2C%22%E6%AD%A4%E8%8A%B1%E5%8C%BA%E5%BD%B9%E6%89%80%22%2C%22%E5%B9%B3%E5%B0%BE%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E9%87%8E%E4%B8%AD%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%A1%83%E8%B0%B7%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E5%A4%A7%E5%AE%AE%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E8%81%96%E8%B3%A2%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B8%85%E6%B1%9F%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%91%82%E9%99%BD%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E4%BB%8A%E5%AE%AE%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E4%B9%9D%E6%9D%A1%E5%8D%97%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E8%8C%A8%E7%94%B0%E5%8C%97%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E5%8D%97%E6%B8%AF%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9C%92%22%2C%22%E5%87%BA%E6%9D%A5%E5%B3%B6%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E5%B0%91%E6%9E%97%E5%AF%BA%22%2C%22%E6%B5%9C%E5%AF%BA%22%2C%22%E4%B8%89%E5%AE%9D%22%2C%22%E8%8B%A5%E6%9D%BE%E5%8F%B0%22%2C%22%E7%9F%B3%E6%B4%A5%22%2C%22%E7%99%BB%E7%BE%8E%E4%B8%98%22%2C%22%E6%B7%B1%E4%BA%95%22%2C%22%E7%BE%8E%E5%8E%9F%22%2C%22%E9%87%91%E5%B2%A1%E5%8D%97%22%2C%22%E9%AB%98%E7%9F%B3%E6%B6%88%E9%98%B2%E7%BD%B2%E9%AB%98%E5%B8%AB%E6%B5%9C%E5%87%BA%E5%BC%B5%E6%89%80%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%8D%83%E6%88%90%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%8D%83%E9%87%8C%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E5%9E%82%E6%B0%B4%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E5%8C%97%E6%B6%88%E9%98%B2%E7%BD%B2%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E9%AB%98%E9%87%8E%E5%8F%B0%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E8%A5%BF%E4%BF%9D%E5%81%A5%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E5%85%AD%E4%B8%87%E5%AF%BA%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E7%92%B0%E5%A2%83%E8%A1%9B%E7%94%9F%E6%A4%9C%E6%9F%BB%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E6%A5%A0%E8%91%89%22%2C%22%E6%9E%9A%E6%96%B9%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E7%8E%8B%E4%BB%81%E5%85%AC%E5%9C%92%22%2C%22%E9%AB%98%E6%A7%BB%E5%8C%97%22%2C%22%E5%BA%84%E6%89%80%22%2C%22%E5%85%AB%E5%B0%BE%E5%B8%82%E4%BF%9D%E5%81%A5%E6%89%80%22%2C%22%E6%88%90%E7%94%B0%22%2C%22%E5%AF%9D%E5%B1%8B%E5%B7%9D%E5%B8%82%E5%BD%B9%E6%89%80%22%5D%5D%2C%22stationNames%22%3Anull%2C%22timeSpan%22%3Anull%7D&parentFormNo=1021`;
s.split("&").map(s => {
  const [name, val] = s.split("=");
  return [name, decodeURIComponent(val)];
}).forEach(s => console.log(s));
Deno.exit(0);
*/
/*
formNo=040&nextForm=%2Fbin%2Fform1000%2FForm_1021.jsp&dataInfo=%7B%22areaName%22%3Anull%2C%22areaNumber%22%3Anull%2C%22browseEnd%22%3A0%2C%22browsePriod%22%3A%22168%22%2C%22browseStart%22%3A0%2C%22buttonType%22%3Anull%2C%22changeType%22%3Anull%2C%22cmbType%22%3Anull%2C%22dailyRreport%22%3Anull%2C%22dayAdd%22%3A%22168%22%2C%22endDate%22%3A%222021%2F10%2F09%22%2C%22endHour%22%3A%2206%22%2C%22endMin%22%3Anull%2C%22formNo%22%3A0%2C%22graphName%22%3Anull%2C%22id%22%3A%220%22%2C%22itemInfo%22%3A%5B%5B%22009%22%5D%2C%5B%22OX%22%5D%2C%5B%22ppb%22%5D%5D%2C%22itemName%22%3Anull%2C%22kenteiType%22%3Anull%2C%22markStationItem%22%3A%220104_009%2C0107_009%2C0109_009%2C0112_009%2C0115_009%2C0116_009%2C0117_009%2C0118_009%2C0120_009%2C0121_009%2C0122_009%2C0123_009%2C0124_009%2C0125_009%2C0127_009%2C0129_009%2C0130_009%2C0131_009%2C0133_009%2C0202_009%2C0203_009%2C0205_009%2C0206_009%2C0207_009%2C0208_009%2C0209_009%2C0210_009%2C0211_009%2C0212_009%2C0213_009%2C0215_009%2C0252_009%2C0301_009%2C0302_009%2C0304_009%2C0305_009%2C0307_009%2C0309_009%2C0311_009%2C0312_009%2C0313_009%2C0405_009%2C0602_009%2C0651_009%2C0652_009%2C0701_009%2C0703_009%2C0705_009%2C0801_009%2C0802_009%2C0851_009%2C0901_009%2C0902_009%2C0903_009%2C2102_009%2C2103_009%2C2202_009%2C2301_009%2C2302_009%2C%22%2C%22maxId%22%3A%221%22%2C%22maxItemString%22%3A%22%22%2C%22startDate%22%3A%222021%2F10%2F02%22%2C%22startHour%22%3A%2206%22%2C%22startMin%22%3Anull%2C%22stationCodeOfArea%22%3Anull%2C%22stationInfo%22%3A%5B%5B%220104%22%2C%220107%22%2C%220109%22%2C%220112%22%2C%220115%22%2C%220116%22%2C%220117%22%2C%220118%22%2C%220120%22%2C%220121%22%2C%220122%22%2C%220123%22%2C%220124%22%2C%220125%22%2C%220127%22%2C%220129%22%2C%220130%22%2C%220131%22%2C%220133%22%2C%220202%22%2C%220203%22%2C%220205%22%2C%220206%22%2C%220207%22%2C%220208%22%2C%220209%22%2C%220210%22%2C%220211%22%2C%220212%22%2C%220213%22%2C%220215%22%2C%220252%22%2C%220301%22%2C%220302%22%2C%220304%22%2C%220305%22%2C%220307%22%2C%220309%22%2C%220311%22%2C%220312%22%2C%220313%22%2C%220405%22%2C%220602%22%2C%220651%22%2C%220652%22%2C%220701%22%2C%220703%22%2C%220705%22%2C%220801%22%2C%220802%22%2C%220851%22%2C%220901%22%2C%220902%22%2C%220903%22%2C%222102%22%2C%222103%22%2C%222202%22%2C%222301%22%2C%222302%22%5D%2C%5B%22%E8%A5%BF%E9%83%A8%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E5%9B%BD%E8%A8%AD%E5%A4%A7%E9%98%AA%22%2C%22%E8%8C%A8%E6%9C%A8%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E9%AB%98%E7%9F%B3%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B1%A0%E7%94%B0%E5%B8%82%E7%AB%8B%E5%8D%97%E7%95%91%E4%BC%9A%E9%A4%A8%22%2C%22%E5%A4%A7%E6%9D%B1%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%BA%9C%E7%AB%8B%E4%BF%AE%E5%BE%B3%E5%AD%A6%E9%99%A2%22%2C%22%E8%B2%9D%E5%A1%9A%E5%B8%82%E6%B6%88%E9%98%B2%E7%BD%B2%22%2C%22%E5%B3%B6%E6%9C%AC%E7%94%BA%E5%BD%B9%E5%A0%B4%22%2C%22%E5%AF%8C%E7%94%B0%E6%9E%97%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%8D%97%E6%B5%B7%E5%9B%A3%E5%9C%B0%22%2C%22%E6%B3%89%E5%8D%97%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E7%B7%91%E3%82%B1%E4%B8%98%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E4%B8%89%E6%97%A5%E5%B8%82%E5%85%AC%E6%B0%91%E9%A4%A8%22%2C%22%E8%97%A4%E4%BA%95%E5%AF%BA%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%B2%B8%E5%92%8C%E7%94%B0%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9C%92%22%2C%22%E4%BD%90%E9%87%8E%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B3%89%E5%A4%A7%E6%B4%A5%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E8%B1%8A%E8%83%BD%E7%94%BA%E5%BD%B9%E5%A0%B4%22%2C%22%E6%AD%A4%E8%8A%B1%E5%8C%BA%E5%BD%B9%E6%89%80%22%2C%22%E5%B9%B3%E5%B0%BE%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E9%87%8E%E4%B8%AD%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%A1%83%E8%B0%B7%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E5%A4%A7%E5%AE%AE%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E8%81%96%E8%B3%A2%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%B8%85%E6%B1%9F%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E6%91%82%E9%99%BD%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E4%BB%8A%E5%AE%AE%E4%B8%AD%E5%AD%A6%E6%A0%A1%22%2C%22%E4%B9%9D%E6%9D%A1%E5%8D%97%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E8%8C%A8%E7%94%B0%E5%8C%97%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E5%8D%97%E6%B8%AF%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9C%92%22%2C%22%E5%87%BA%E6%9D%A5%E5%B3%B6%E5%B0%8F%E5%AD%A6%E6%A0%A1%22%2C%22%E5%B0%91%E6%9E%97%E5%AF%BA%22%2C%22%E6%B5%9C%E5%AF%BA%22%2C%22%E4%B8%89%E5%AE%9D%22%2C%22%E8%8B%A5%E6%9D%BE%E5%8F%B0%22%2C%22%E7%9F%B3%E6%B4%A5%22%2C%22%E7%99%BB%E7%BE%8E%E4%B8%98%22%2C%22%E6%B7%B1%E4%BA%95%22%2C%22%E7%BE%8E%E5%8E%9F%22%2C%22%E9%87%91%E5%B2%A1%E5%8D%97%22%2C%22%E9%AB%98%E7%9F%B3%E6%B6%88%E9%98%B2%E7%BD%B2%E9%AB%98%E5%B8%AB%E6%B5%9C%E5%87%BA%E5%BC%B5%E6%89%80%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%8D%83%E6%88%90%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%8D%83%E9%87%8C%22%2C%22%E8%B1%8A%E4%B8%AD%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E5%9E%82%E6%B0%B4%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E5%8C%97%E6%B6%88%E9%98%B2%E7%BD%B2%22%2C%22%E5%90%B9%E7%94%B0%E5%B8%82%E9%AB%98%E9%87%8E%E5%8F%B0%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E8%A5%BF%E4%BF%9D%E5%81%A5%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E5%85%AD%E4%B8%87%E5%AF%BA%22%2C%22%E6%9D%B1%E5%A4%A7%E9%98%AA%E5%B8%82%E7%92%B0%E5%A2%83%E8%A1%9B%E7%94%9F%E6%A4%9C%E6%9F%BB%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%22%2C%22%E6%A5%A0%E8%91%89%22%2C%22%E6%9E%9A%E6%96%B9%E5%B8%82%E5%BD%B9%E6%89%80%22%2C%22%E7%8E%8B%E4%BB%81%E5%85%AC%E5%9C%92%22%2C%22%E9%AB%98%E6%A7%BB%E5%8C%97%22%2C%22%E5%BA%84%E6%89%80%22%2C%22%E5%85%AB%E5%B0%BE%E5%B8%82%E4%BF%9D%E5%81%A5%E6%89%80%22%2C%22%E6%88%90%E7%94%B0%22%2C%22%E5%AF%9D%E5%B1%8B%E5%B7%9D%E5%B8%82%E5%BD%B9%E6%89%80%22%5D%5D%2C%22stationNames%22%3Anull%2C%22timeSpan%22%3Anull%7D&parentFormNo=1021
*/

export const downloadTaikiOsaka = async (date, hour) => {
  //const endDate = "2021/10/09";
  const endDate = "2021/10/09"; // 無効
  //const endHour = "06";
  const endHour = "07"; // 無効
  //const startDate = "2021/10/02";
  const d2 = date.dayBefore(7);
  const startDate = d2.year + "/" + fix0(d2.month, 2) + "/" + fix0(d2.day, 2);
  //const startDate = date; //"2021/10/01"; // 有効 .. 1週間後のデータが取得できる
    //const startHour = "06";
  const startHour = fix0(hour); // 有効
  const dayAdd = 168; // 24時間 x 7
  const itemInfo = '["009"],["OX"],["ppb"]';
  console.log(startDate, hour);

  const url = "http://taiki.kankyo.pref.osaka.jp/taikiWebApp/MainLogic";
  const param = {
    formNo: "040", // 1021,
    "040btnCsv": "CSV出力",
    nextForm: "/bin/form1000/Form_1021.jsp",
    dataInfo: `{"areaName":null,"areaNumber":null,"browseEnd":0,"browsePriod":"168","browseStart":0,"buttonType":null,"changeType":null,"cmbType":null,"dailyRreport":null,"dayAdd":"${dayAdd}","endDate":"${endDate}","endHour":"${endHour}","endMin":null,"formNo":0,"graphName":null,"id":"0","itemInfo":[${itemInfo}],"itemName":null,"kenteiType":null,"markStationItem":"0104_009,0107_009,0109_009,0112_009,0115_009,0116_009,0117_009,0118_009,0120_009,0121_009,0122_009,0123_009,0124_009,0125_009,0127_009,0129_009,0130_009,0131_009,0133_009,0202_009,0203_009,0205_009,0206_009,0207_009,0208_009,0209_009,0210_009,0211_009,0212_009,0213_009,0215_009,0252_009,0301_009,0302_009,0304_009,0305_009,0307_009,0309_009,0311_009,0312_009,0313_009,0405_009,0602_009,0651_009,0652_009,0701_009,0703_009,0705_009,0801_009,0802_009,0851_009,0901_009,0902_009,0903_009,2102_009,2103_009,2202_009,2301_009,2302_009,","maxId":"1","maxItemString":"","startDate":"${startDate}","startHour":"${startHour}","startMin":null,"stationCodeOfArea":null,"stationInfo":[["0104","0107","0109","0112","0115","0116","0117","0118","0120","0121","0122","0123","0124","0125","0127","0129","0130","0131","0133","0202","0203","0205","0206","0207","0208","0209","0210","0211","0212","0213","0215","0252","0301","0302","0304","0305","0307","0309","0311","0312","0313","0405","0602","0651","0652","0701","0703","0705","0801","0802","0851","0901","0902","0903","2102","2103","2202","2301","2302"],["西部コミュニティセンター","国設大阪","茨木市役所","高石中学校","池田市立南畑会館","大東市役所","府立修徳学院","貝塚市消防署","島本町役場","富田林市役所","南海団地","泉南市役所","緑ケ丘小学校","三日市公民館","藤井寺市役所","岸和田中央公園","佐野中学校","泉大津市役所","豊能町役場","此花区役所","平尾小学校","野中小学校","桃谷中学校","大宮中学校","聖賢小学校","清江小学校","摂陽中学校","今宮中学校","九条南小学校","茨田北小学校","南港中央公園","出来島小学校","少林寺","浜寺","三宝","若松台","石津","登美丘","深井","美原","金岡南","高石消防署高師浜出張所","豊中市千成","豊中市千里","豊中市役所","吹田市垂水","吹田市北消防署","吹田市高野台","東大阪市西保健センター","東大阪市六万寺","東大阪市環境衛生検査センター","楠葉","枚方市役所","王仁公園","高槻北","庄所","八尾市保健所","成田","寝屋川市役所"]],"stationNames":null,"timeSpan":null}`,
    parentFormNo: "1021",
    //CTRL_NO_040: "040",
  };
  const bin = await fetchBinPOST(url, param);
  const txt = SJIS.decode(bin);
  console.log(txt);
  const csv = CSV.decode(txt);
  const n = csv[1][0].replace(/\//g, " ").split(" ").map(n => parseInt(n));
  const datetime = new DateTime(new Day(n[0], n[1], n[2]), new Time(n[3], 0));
  console.log(datetime);
  const type = csv[2][1];
  csv.shift();
  csv.shift();
  csv.shift();
  const path = "data/" + type + "/" + datetime.day.year + fix0(datetime.day.month, 2);
  await Deno.mkdir(path, { recursive: true });
  const fn = path + "/" + type + "-" + datetime.toStringMinLog() + ".csv";
  const scsv = CSV.encode(csv);
  await Deno.writeTextFile(fn, scsv);
  return CSV.toJSON(csv);
};

/*
for (let i = 0; i < 7; i++) {
  await downloadTaikiOsaka(i);
}
*/
//await downloadTaikiOsaka(new Day("2021/09/30"), 0);


/*
let d = new Day(2021, 10, 9);
for (let j = 0; j < 10; j++) {
  console.log(d);
  for (let i = 1; i <= 24; i++) {
    await downloadTaikiOsaka(d, i);
    //console.log(startDate);
    await sleep(100);
  }
  d = d.dayBefore(1);
}
*/

// today
/*
let d = new Day();
const t = new Time();
for (let i = 1; i <= t.hour; i++) {
  await downloadTaikiOsaka(d, i);
  console.log(d, i);
  await sleep(100);
}
*/
/*
// this hour
let d = new Day();
const t = new Time();
await downloadTaikiOsaka(d, t.hour);
*/
